# TradeMaster Webç•Œé¢æ·±åº¦é›†æˆæ–¹æ¡ˆ

> **é¡¹ç›®ç›®æ ‡**ï¼šå°†TradeMaster Webç•Œé¢ä»æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼å‡çº§ä¸ºå®Œå…¨é›†æˆTradeMasteræ ¸å¿ƒåŠŸèƒ½çš„ç”Ÿäº§çº§é‡åŒ–äº¤æ˜“å¹³å°

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-28  
**åˆ¶å®šäºº**: çŒ«å¨˜å·¥ç¨‹å¸ˆ æµ®æµ®é…±  
**é¡¹ç›®å‘¨æœŸ**: 6-8å‘¨  

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### å½“å‰é—®é¢˜
- âŒ **æ¨¡æ‹Ÿæ•°æ®é—®é¢˜**: å‰åç«¯å¤§é‡ä½¿ç”¨ç¡¬ç¼–ç çš„æ¨¡æ‹Ÿæ•°æ®
- âŒ **åŠŸèƒ½ç¼ºå¤±**: æ— æ³•çœŸæ­£æ‰§è¡ŒTradeMasteré‡åŒ–äº¤æ˜“ç­–ç•¥
- âŒ **å®æ—¶æ€§ä¸è¶³**: ç¼ºä¹è®­ç»ƒè¿‡ç¨‹çš„å®æ—¶ç›‘æ§å’Œæ•°æ®æ¨é€
- âŒ **é›†æˆä¸å®Œæ•´**: ç°æœ‰é›†æˆæœåŠ¡æœªå……åˆ†åˆ©ç”¨TradeMasteræ ¸å¿ƒèƒ½åŠ›

### è§£å†³æ–¹æ¡ˆæ¦‚è¿°
é€šè¿‡**å¾®æœåŠ¡æ¶æ„**å’Œ**å¼‚æ­¥ä»»åŠ¡å¤„ç†**ï¼Œå®ç°Webç•Œé¢ä¸TradeMasteræ ¸å¿ƒçš„æ·±åº¦é›†æˆï¼Œæä¾›å®Œæ•´çš„é‡åŒ–äº¤æ˜“å¹³å°èƒ½åŠ›ã€‚

### æ ¸å¿ƒä»·å€¼
- ğŸš€ **çœŸå®äº¤æ˜“èƒ½åŠ›**: æ”¯æŒå›æµ‹ã€æ¨¡æ‹Ÿå’Œå®ç›˜äº¤æ˜“
- ğŸ“Š **å®æ—¶ç›‘æ§**: è®­ç»ƒå’Œæ‰§è¡Œè¿‡ç¨‹çš„å®æ—¶å¯è§†åŒ–
- ğŸ”„ **å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†**: ç­–ç•¥åˆ›å»ºã€è®­ç»ƒã€éƒ¨ç½²ã€ç›‘æ§ä¸€ä½“åŒ–
- ğŸ›¡ï¸ **ç”Ÿäº§çº§å¯é æ€§**: å®¹é”™ã€æ¢å¤ã€ç›‘æ§ã€å®‰å…¨æœºåˆ¶

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„è®¾è®¡

### æ€»ä½“æ¶æ„å›¾

```mermaid
graph TB
    subgraph "å‰ç«¯å±‚ - React SPA"
        UI[ç”¨æˆ·ç•Œé¢]
        WS[WebSocketå®¢æˆ·ç«¯]
    end
    
    subgraph "APIç½‘å…³å±‚"
        NGINX[Nginxåå‘ä»£ç†]
        LB[è´Ÿè½½å‡è¡¡]
    end
    
    subgraph "åº”ç”¨æœåŠ¡å±‚"
        API[FastAPIæœåŠ¡]
        WS_SERVER[WebSocketæœåŠ¡]
    end
    
    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        TM_SERVICE[TradeMasteré›†æˆæœåŠ¡]
        STRATEGY_SERVICE[ç­–ç•¥ç®¡ç†æœåŠ¡]
        CONFIG_SERVICE[é…ç½®ç”ŸæˆæœåŠ¡]
        MONITOR_SERVICE[ç›‘æ§æœåŠ¡]
    end
    
    subgraph "ä»»åŠ¡å¤„ç†å±‚"
        CELERY[Celeryä»»åŠ¡é˜Ÿåˆ—]
        REDIS_BROKER[Redisæ¶ˆæ¯ä»£ç†]
        WORKER1[è®­ç»ƒWorker]
        WORKER2[å›æµ‹Worker]
        WORKER3[ç›‘æ§Worker]
    end
    
    subgraph "æ•°æ®å±‚"
        POSTGRES[(PostgreSQL)]
        REDIS[(Redisç¼“å­˜)]
        FILES[æ–‡ä»¶å­˜å‚¨]
    end
    
    subgraph "TradeMasteræ ¸å¿ƒ"
        TM_CORE[TradeMasterå¼•æ“]
        AGENTS[äº¤æ˜“ä»£ç†]
        DATASETS[æ•°æ®é›†]
        TRAINERS[è®­ç»ƒå™¨]
    end
    
    UI --> NGINX
    WS --> NGINX
    NGINX --> API
    NGINX --> WS_SERVER
    
    API --> TM_SERVICE
    API --> STRATEGY_SERVICE
    WS_SERVER --> MONITOR_SERVICE
    
    TM_SERVICE --> CONFIG_SERVICE
    TM_SERVICE --> CELERY
    STRATEGY_SERVICE --> POSTGRES
    MONITOR_SERVICE --> REDIS
    
    CELERY --> REDIS_BROKER
    REDIS_BROKER --> WORKER1
    REDIS_BROKER --> WORKER2
    REDIS_BROKER --> WORKER3
    
    WORKER1 --> TM_CORE
    WORKER2 --> TM_CORE
    WORKER3 --> FILES
    
    TM_CORE --> AGENTS
    TM_CORE --> DATASETS
    TM_CORE --> TRAINERS
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

| å±‚æ¬¡ | æŠ€æœ¯é€‰å‹ | ä½œç”¨ | ç‰ˆæœ¬ |
|------|----------|------|------|
| **å‰ç«¯** | React + TypeScript | ç”¨æˆ·ç•Œé¢ | 18.2+ |
| **å‰ç«¯æ„å»º** | Vite + Ant Design | æ„å»ºå·¥å…·å’ŒUIç»„ä»¶åº“ | 5.0+ |
| **åç«¯API** | FastAPI + Pydantic | å¼‚æ­¥WebæœåŠ¡ | 0.104+ |
| **ä»»åŠ¡é˜Ÿåˆ—** | Celery + Redis | å¼‚æ­¥ä»»åŠ¡å¤„ç† | 5.3+ |
| **æ•°æ®åº“** | PostgreSQL + SQLAlchemy | æ•°æ®æŒä¹…åŒ– | 14+ |
| **ç¼“å­˜** | Redis | ä¼šè¯å’Œç¼“å­˜ | 7.0+ |
| **å®æ—¶é€šä¿¡** | WebSocket | å®æ—¶æ•°æ®æ¨é€ | - |
| **å®¹å™¨åŒ–** | Docker + Docker Compose | æœåŠ¡ç¼–æ’ | 24.0+ |
| **ç›‘æ§** | Prometheus + Grafana | ç³»ç»Ÿç›‘æ§ | æœ€æ–° |

---

## ğŸ”§ æ ¸å¿ƒæœåŠ¡ç»„ä»¶è®¾è®¡

### 1. TradeMasteré›†æˆæœåŠ¡ (TradeMasterService)

**èŒè´£**: ä½œä¸ºWebç•Œé¢ä¸TradeMasteræ ¸å¿ƒçš„é€‚é…å±‚

```python
class TradeMasterService:
    """TradeMasteræ ¸å¿ƒé›†æˆæœåŠ¡"""
    
    async def create_strategy_config(self, params: dict) -> str:
        """ç”ŸæˆTradeMasteré…ç½®æ–‡ä»¶"""
        
    async def submit_training_task(self, strategy_id: str, config: dict) -> str:
        """æäº¤è®­ç»ƒä»»åŠ¡åˆ°Celeryé˜Ÿåˆ—"""
        
    async def start_backtest(self, strategy_id: str, config: dict) -> str:
        """å¯åŠ¨å›æµ‹ä»»åŠ¡"""
        
    async def deploy_strategy(self, strategy_id: str, mode: str) -> str:
        """éƒ¨ç½²ç­–ç•¥åˆ°ç”Ÿäº§ç¯å¢ƒ"""
        
    async def get_real_time_metrics(self, session_id: str) -> dict:
        """è·å–å®æ—¶æ€§èƒ½æŒ‡æ ‡"""
```

**å…³é”®ç‰¹æ€§**:
- âœ… é…ç½®æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆå’ŒéªŒè¯
- âœ… å¤šç¯å¢ƒæ”¯æŒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰
- âœ… å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤
- âœ… èµ„æºä½¿ç”¨ç›‘æ§å’Œé™åˆ¶

### 2. ä»»åŠ¡ç®¡ç†æœåŠ¡ (TaskManager)

**èŒè´£**: ç®¡ç†é•¿æœŸè¿è¡Œçš„è®­ç»ƒå’Œå›æµ‹ä»»åŠ¡

```python
@celery.task(bind=True)
class TrainingTask:
    """è®­ç»ƒä»»åŠ¡å¤„ç†å™¨"""
    
    def run(self, strategy_id: str, config: dict):
        """æ‰§è¡ŒTradeMasterè®­ç»ƒ"""
        # 1. ç¯å¢ƒå‡†å¤‡å’Œé…ç½®éªŒè¯
        # 2. å¯åŠ¨TradeMasterè®­ç»ƒè¿›ç¨‹
        # 3. å®æ—¶ç›‘æ§è®­ç»ƒè¿›ç¨‹
        # 4. æ”¶é›†å’Œæ¨é€æ€§èƒ½æŒ‡æ ‡
        # 5. å¤„ç†å¼‚å¸¸å’Œæ¸…ç†èµ„æº
```

**æ ¸å¿ƒèƒ½åŠ›**:
- ğŸ”„ ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- ğŸ“Š è¿›åº¦è·Ÿè¸ªå’ŒçŠ¶æ€æ›´æ–°
- âš¡ èµ„æºåˆ†é…å’Œè°ƒåº¦
- ğŸ›¡ï¸ æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤

### 3. å®æ—¶æ•°æ®æœåŠ¡ (RealTimeDataService)

**èŒè´£**: å¤„ç†è®­ç»ƒè¿‡ç¨‹ä¸­çš„å®æ—¶æ•°æ®æ¨é€

```python
class RealTimeDataService:
    """å®æ—¶æ•°æ®æ¨é€æœåŠ¡"""
    
    async def start_monitoring(self, session_id: str):
        """å¼€å§‹ç›‘æ§è®­ç»ƒè¿‡ç¨‹"""
        
    async def push_training_metrics(self, data: dict):
        """æ¨é€è®­ç»ƒæŒ‡æ ‡åˆ°å‰ç«¯"""
        
    async def push_performance_update(self, strategy_id: str, metrics: dict):
        """æ¨é€æ€§èƒ½æ›´æ–°"""
```

**æŠ€æœ¯å®ç°**:
- ğŸŒ WebSocketåŒå‘é€šä¿¡
- ğŸ“ˆ å®æ—¶å›¾è¡¨æ•°æ®æµ
- ğŸš¨ å¼‚å¸¸å’Œå‘Šè­¦æ¨é€
- ğŸ’¾ æ•°æ®ç¼“å­˜å’ŒæŒä¹…åŒ–

### 4. é…ç½®ç®¡ç†æœåŠ¡ (ConfigurationService)

**èŒè´£**: ç®¡ç†ç­–ç•¥é…ç½®å’Œå‚æ•°éªŒè¯

```python
class ConfigurationService:
    """é…ç½®ç®¡ç†æœåŠ¡"""
    
    def generate_trademaster_config(self, web_params: dict) -> str:
        """å°†Webå‚æ•°è½¬æ¢ä¸ºTradeMasteré…ç½®"""
        
    def validate_configuration(self, config: dict) -> ValidationResult:
        """éªŒè¯é…ç½®æœ‰æ•ˆæ€§"""
        
    def get_default_parameters(self, strategy_type: str) -> dict:
        """è·å–é»˜è®¤å‚æ•°"""
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡æ‰©å±•

### æ–°å¢æ ¸å¿ƒè¡¨ç»“æ„

```sql
-- ç­–ç•¥æ‰§è¡Œä¼šè¯è¡¨
CREATE TABLE strategy_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    strategy_id UUID REFERENCES strategies(id),
    session_type VARCHAR(50) NOT NULL, -- 'training', 'backtest', 'live'
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
    config JSONB NOT NULL,
    started_at TIMESTAMP WITH TIME ZONE,
    completed_at TIMESTAMP WITH TIME ZONE,
    celery_task_id VARCHAR(100) UNIQUE,
    process_id INTEGER,
    log_file_path TEXT,
    result_data JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- å®æ—¶æ€§èƒ½æŒ‡æ ‡è¡¨
CREATE TABLE performance_metrics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID REFERENCES strategy_sessions(id),
    metric_type VARCHAR(50) NOT NULL, -- 'loss', 'return', 'sharpe', etc.
    metric_value DECIMAL(15,8) NOT NULL,
    epoch INTEGER,
    timestamp TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    metadata JSONB
);

-- ç³»ç»Ÿèµ„æºä½¿ç”¨è®°å½•
CREATE TABLE resource_usage (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID REFERENCES strategy_sessions(id),
    cpu_percent DECIMAL(5,2),
    memory_mb INTEGER,
    gpu_percent DECIMAL(5,2),
    gpu_memory_mb INTEGER,
    disk_io_mb DECIMAL(10,2),
    network_io_mb DECIMAL(10,2),
    recorded_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- åˆ›å»ºç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_strategy_sessions_strategy_id ON strategy_sessions(strategy_id);
CREATE INDEX idx_strategy_sessions_status ON strategy_sessions(status);
CREATE INDEX idx_performance_metrics_session_id ON performance_metrics(session_id);
CREATE INDEX idx_performance_metrics_timestamp ON performance_metrics(timestamp);
CREATE INDEX idx_resource_usage_session_id ON resource_usage(session_id);
```

---

## ğŸš€ åˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ

### é˜¶æ®µ1: åŸºç¡€é›†æˆæ¶æ„ (1-2å‘¨)

**ç›®æ ‡**: å»ºç«‹å¯å·¥ä½œçš„åŸºç¡€é›†æˆæ¡†æ¶

#### ä¸»è¦äº¤ä»˜ç‰©
1. **é‡æ„ç­–ç•¥APIæœåŠ¡**
   - ç§»é™¤æ‰€æœ‰æ¨¡æ‹Ÿæ•°æ®è¿”å›
   - é›†æˆTradeMasterServiceè°ƒç”¨
   - å®ç°åŸºç¡€çš„CRUDæ“ä½œ

2. **é…ç½®ç”Ÿæˆå™¨å®ç°**
   - Webå‚æ•°åˆ°TradeMasteré…ç½®çš„è½¬æ¢
   - å‚æ•°éªŒè¯å’Œé»˜è®¤å€¼å¤„ç†
   - é…ç½®æ–‡ä»¶æ¨¡æ¿ç³»ç»Ÿ

3. **åŸºç¡€ä»»åŠ¡ç®¡ç†**
   - Celeryé›†æˆå’Œé…ç½®
   - ç®€å•çš„è®­ç»ƒä»»åŠ¡æ‰§è¡Œ
   - ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª

#### æŠ€æœ¯ä»»åŠ¡æ¸…å•
- [ ] è®¾ç½®Celeryå’ŒRedisé…ç½®
- [ ] å®ç°ConfigurationServiceåŸºç¡€åŠŸèƒ½
- [ ] é‡æ„strategies.py APIç«¯ç‚¹
- [ ] åˆ›å»ºåŸºç¡€çš„TradeMasteré…ç½®æ¨¡æ¿
- [ ] å®ç°ç®€å•çš„ä»»åŠ¡æäº¤å’ŒçŠ¶æ€æŸ¥è¯¢
- [ ] æ›´æ–°å‰ç«¯Dashboardè¿æ¥çœŸå®API

#### éªŒæ”¶æ ‡å‡†
- âœ… ç­–ç•¥åˆ›å»ºåŠŸèƒ½ä½¿ç”¨çœŸå®TradeMasteré…ç½®
- âœ… å¯ä»¥æˆåŠŸæäº¤è®­ç»ƒä»»åŠ¡åˆ°é˜Ÿåˆ—
- âœ… å‰ç«¯å¯ä»¥æ˜¾ç¤ºçœŸå®çš„ç­–ç•¥çŠ¶æ€
- âœ… åŸºç¡€çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### é˜¶æ®µ2: æ ¸å¿ƒè®­ç»ƒåŠŸèƒ½ (2-3å‘¨)

**ç›®æ ‡**: å®ç°å®Œæ•´çš„è®­ç»ƒç”Ÿå‘½å‘¨æœŸç®¡ç†

#### ä¸»è¦äº¤ä»˜ç‰©
1. **è®­ç»ƒä»»åŠ¡æ‰§è¡Œå™¨**
   - å®Œæ•´çš„TradeMasterè®­ç»ƒæµç¨‹é›†æˆ
   - è¿›ç¨‹ç›‘æ§å’Œç®¡ç†
   - å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶

2. **å®æ—¶æ•°æ®æ¨é€ç³»ç»Ÿ**
   - WebSocketæœåŠ¡å®ç°
   - è®­ç»ƒè¿‡ç¨‹å®æ—¶ç›‘æ§
   - å‰ç«¯å®æ—¶å›¾è¡¨æ›´æ–°

3. **å›æµ‹åŠŸèƒ½é›†æˆ**
   - å†å²æ•°æ®å›æµ‹
   - æ€§èƒ½æŒ‡æ ‡è®¡ç®—
   - ç»“æœå¯è§†åŒ–

#### æŠ€æœ¯å®ç°ç¤ºä¾‹

```python
# è®­ç»ƒä»»åŠ¡æ‰§è¡Œå™¨
@celery.task(bind=True, max_retries=3)
def execute_training_task(self, strategy_id: str, config: dict):
    """æ‰§è¡ŒTradeMasterè®­ç»ƒä»»åŠ¡"""
    try:
        # 1. å‡†å¤‡è®­ç»ƒç¯å¢ƒ
        training_env = prepare_training_environment(config)
        
        # 2. å¯åŠ¨è®­ç»ƒè¿›ç¨‹
        process = start_trademaster_training(training_env)
        
        # 3. ç›‘æ§è®­ç»ƒè¿‡ç¨‹
        monitor_training_process(process, strategy_id)
        
        # 4. æ”¶é›†è®­ç»ƒç»“æœ
        results = collect_training_results(process)
        
        return results
        
    except Exception as exc:
        # å¼‚å¸¸å¤„ç†å’Œé‡è¯•
        self.retry(countdown=60, exc=exc)
```

#### éªŒæ”¶æ ‡å‡†
- âœ… å¯ä»¥æˆåŠŸè¿è¡Œå®Œæ•´çš„TradeMasterè®­ç»ƒæµç¨‹
- âœ… å‰ç«¯å¯ä»¥å®æ—¶æŸ¥çœ‹è®­ç»ƒè¿›åº¦å’ŒæŸå¤±æ›²çº¿
- âœ… æ”¯æŒè®­ç»ƒä»»åŠ¡çš„æš‚åœã€ç»§ç»­ã€åœæ­¢æ“ä½œ
- âœ… å›æµ‹åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š

### é˜¶æ®µ3: é«˜çº§åŠŸèƒ½å’Œä¼˜åŒ– (2-4å‘¨)

**ç›®æ ‡**: å®ç°ç”Ÿäº§çº§åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–

#### ä¸»è¦äº¤ä»˜ç‰©
1. **èµ„æºç®¡ç†å’Œè°ƒåº¦**
   - GPU/CPUèµ„æºåˆ†é…
   - ä»»åŠ¡ä¼˜å…ˆçº§å’Œé˜Ÿåˆ—ç®¡ç†
   - èµ„æºä½¿ç”¨ç›‘æ§

2. **å®¹å™¨åŒ–è®­ç»ƒç¯å¢ƒ**
   - Dockerå®¹å™¨éš”ç¦»
   - ç¯å¢ƒä¸€è‡´æ€§ä¿è¯
   - æ‰©å±•æ€§æ”¯æŒ

3. **å®ç›˜äº¤æ˜“é›†æˆ**
   - äº¤æ˜“æ¥å£é›†æˆ
   - é£é™©æ§åˆ¶æœºåˆ¶
   - å®ç›˜ç›‘æ§å’Œå‘Šè­¦

#### å®‰å…¨æœºåˆ¶è®¾è®¡

```python
class TradingRiskController:
    """å®ç›˜äº¤æ˜“é£é™©æ§åˆ¶å™¨"""
    
    def validate_trading_request(self, request: TradingRequest) -> bool:
        """éªŒè¯äº¤æ˜“è¯·æ±‚"""
        # 1. èµ„é‡‘é™é¢æ£€æŸ¥
        # 2. æŒä»“é™åˆ¶éªŒè¯
        # 3. é£é™©æŒ‡æ ‡è®¡ç®—
        # 4. ç”¨æˆ·æƒé™éªŒè¯
        
    def apply_risk_limits(self, strategy_config: dict) -> dict:
        """åº”ç”¨é£é™©é™åˆ¶"""
        # è®¾ç½®æœ€å¤§æŸå¤±é™åˆ¶ã€æŒä»“é™åˆ¶ç­‰
        
    def emergency_stop(self, strategy_id: str) -> bool:
        """ç´§æ€¥åœæ­¢äº¤æ˜“"""
        # ç«‹å³åœæ­¢ç­–ç•¥æ‰§è¡Œå¹¶å¹³ä»“
```

#### éªŒæ”¶æ ‡å‡†
- âœ… æ”¯æŒå¤šç”¨æˆ·å¹¶å‘è®­ç»ƒï¼Œèµ„æºåˆç†åˆ†é…
- âœ… å®¹å™¨åŒ–éƒ¨ç½²ï¼Œç¯å¢ƒéš”ç¦»å¯é 
- âœ… å®ç›˜äº¤æ˜“åŠŸèƒ½å®Œæ•´ï¼Œé£é™©æ§åˆ¶åˆ°ä½
- âœ… ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§è¾¾åˆ°ç”Ÿäº§è¦æ±‚

### é˜¶æ®µ4: ç›‘æ§è¿ç»´å’Œæ–‡æ¡£ (1-2å‘¨)

**ç›®æ ‡**: å®Œå–„ç›‘æ§ä½“ç³»å’Œäº¤ä»˜æ–‡æ¡£

#### ä¸»è¦äº¤ä»˜ç‰©
1. **å…¨é¢ç›‘æ§ç³»ç»Ÿ**
   - PrometheusæŒ‡æ ‡æ”¶é›†
   - Grafanaå¯è§†åŒ–é¢æ¿
   - å‘Šè­¦è§„åˆ™é…ç½®

2. **å®Œæ•´æ–‡æ¡£ä½“ç³»**
   - æŠ€æœ¯æ–‡æ¡£å’ŒAPIæ–‡æ¡£
   - ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
   - è¿ç»´éƒ¨ç½²æŒ‡å—

3. **è‡ªåŠ¨åŒ–éƒ¨ç½²**
   - CI/CDæµæ°´çº¿
   - ç¯å¢ƒè‡ªåŠ¨åŒ–éƒ¨ç½²
   - æ•°æ®åº“è¿ç§»è„šæœ¬

#### éªŒæ”¶æ ‡å‡†
- âœ… å®Œæ•´çš„ç›‘æ§é¢æ¿å’Œå‘Šè­¦ä½“ç³»
- âœ… è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
- âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹éªŒè¯é€šè¿‡
- âœ… æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•é€šè¿‡

---

## ğŸ”’ å®‰å…¨æ€§è®¾è®¡

### è®¤è¯å’Œæˆæƒ

```python
# JWT Tokenå¢å¼º
class EnhancedJWTService:
    def create_token(self, user: User, permissions: List[str]) -> str:
        """åˆ›å»ºåŒ…å«æƒé™çš„JWT Token"""
        payload = {
            "user_id": user.id,
            "permissions": permissions,
            "trading_enabled": user.trading_enabled,
            "risk_level": user.risk_level
        }
        return jwt.encode(payload, secret_key, algorithm="HS256")
```

### å®ç›˜äº¤æ˜“å®‰å…¨æœºåˆ¶

1. **å¤šé‡ç¡®è®¤æœºåˆ¶**
   - ç”¨æˆ·å¯†ç /2FAéªŒè¯
   - äº¤æ˜“å‰é£é™©è¯„ä¼°
   - èµ„é‡‘é™é¢åŒé‡æ£€æŸ¥

2. **æƒé™åˆ†çº§æ§åˆ¶**
   - ç®¡ç†å‘˜ï¼šç³»ç»Ÿé…ç½®å’Œç”¨æˆ·ç®¡ç†
   - é«˜çº§ç”¨æˆ·ï¼šå®ç›˜äº¤æ˜“æƒé™
   - æ™®é€šç”¨æˆ·ï¼šä»…å›æµ‹å’Œæ¨¡æ‹Ÿäº¤æ˜“

3. **å®¡è®¡æ—¥å¿—**
   - æ‰€æœ‰äº¤æ˜“æ“ä½œè®°å½•
   - æ•æ„Ÿæ“ä½œè¯¦ç»†å®¡è®¡
   - åˆè§„æ€§æŠ¥å‘Šç”Ÿæˆ

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ†åŒºç­–ç•¥ - æŒ‰æ—¶é—´åˆ†åŒºæ€§èƒ½æŒ‡æ ‡è¡¨
CREATE TABLE performance_metrics_y2024m01 PARTITION OF performance_metrics
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');

-- ç‰©åŒ–è§†å›¾ - ç­–ç•¥æ€§èƒ½æ±‡æ€»
CREATE MATERIALIZED VIEW strategy_performance_summary AS
SELECT 
    strategy_id,
    COUNT(*) as total_sessions,
    AVG(final_return) as avg_return,
    MAX(final_return) as best_return,
    STDDEV(final_return) as return_volatility
FROM strategy_sessions
WHERE status = 'completed'
GROUP BY strategy_id;
```

### 2. ç¼“å­˜ç­–ç•¥

```python
# Redisç¼“å­˜å±‚è®¾è®¡
class CacheService:
    def cache_strategy_metrics(self, strategy_id: str, metrics: dict, ttl: int = 300):
        """ç¼“å­˜ç­–ç•¥æ€§èƒ½æŒ‡æ ‡"""
        key = f"strategy_metrics:{strategy_id}"
        redis_client.setex(key, ttl, json.dumps(metrics))
    
    def get_cached_metrics(self, strategy_id: str) -> Optional[dict]:
        """è·å–ç¼“å­˜çš„æŒ‡æ ‡"""
        key = f"strategy_metrics:{strategy_id}"
        cached = redis_client.get(key)
        return json.loads(cached) if cached else None
```

### 3. å¼‚æ­¥å¤„ç†ä¼˜åŒ–

```python
# æ‰¹é‡æ•°æ®å¤„ç†
async def batch_process_metrics(metrics_batch: List[dict]):
    """æ‰¹é‡å¤„ç†æ€§èƒ½æŒ‡æ ‡"""
    async with database.transaction():
        await database.executemany(
            "INSERT INTO performance_metrics (...) VALUES (...)",
            metrics_batch
        )
```

---

## ğŸš¨ é£é™©è¯„ä¼°å’Œç¼“è§£æªæ–½

### æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| TradeMasteré›†æˆå¤æ‚æ€§ | é«˜ | ä¸­ | åˆ†é˜¶æ®µé›†æˆï¼Œå……åˆ†æµ‹è¯•ï¼Œä¿æŒå‘åå…¼å®¹ |
| æ€§èƒ½ç“¶é¢ˆ | ä¸­ | ä¸­ | æ€§èƒ½æµ‹è¯•ï¼Œèµ„æºç›‘æ§ï¼Œæ°´å¹³æ‰©å±•è®¾è®¡ |
| æ•°æ®ä¸€è‡´æ€§é—®é¢˜ | é«˜ | ä½ | äº‹åŠ¡ç®¡ç†ï¼Œæ•°æ®æ ¡éªŒï¼Œå¤‡ä»½æ¢å¤ |
| å®ç›˜äº¤æ˜“é£é™© | æé«˜ | ä½ | å¤šé‡å®‰å…¨æœºåˆ¶ï¼Œåˆ†çº§æƒé™ï¼Œé£é™©é™åˆ¶ |

### ä¸šåŠ¡é£é™©

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| ç”¨æˆ·æ¥å—åº¦ | ä¸­ | ä¸­ | ç”¨æˆ·åŸ¹è®­ï¼Œå¹³æ»‘è¿ç§»ï¼ŒåŠŸèƒ½æ¼”ç¤º |
| æ•°æ®å®‰å…¨é—®é¢˜ | é«˜ | ä½ | åŠ å¯†å­˜å‚¨ï¼Œè®¿é—®æ§åˆ¶ï¼Œå®¡è®¡æ—¥å¿— |
| åˆè§„æ€§è¦æ±‚ | ä¸­ | ä¸­ | æ³•è§„è°ƒç ”ï¼Œåˆè§„è®¾è®¡ï¼Œå®šæœŸå®¡æŸ¥ |

### åº”æ€¥é¢„æ¡ˆ

1. **ç³»ç»Ÿæ•…éšœæ¢å¤**
   - æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤
   - æœåŠ¡è‡ªåŠ¨é‡å¯æœºåˆ¶
   - ç°åº¦å‘å¸ƒå’Œå¿«é€Ÿå›æ»š

2. **äº¤æ˜“å¼‚å¸¸å¤„ç†**
   - è‡ªåŠ¨ç†”æ–­æœºåˆ¶
   - ç´§æ€¥åœæ­¢æ‰€æœ‰äº¤æ˜“
   - å¼‚å¸¸é€šçŸ¥å’Œäººå·¥ä»‹å…¥

---

## ğŸ“Š é¡¹ç›®è®¡åˆ’å’Œé‡Œç¨‹ç¢‘

### æ€»ä½“æ—¶é—´çº¿

```mermaid
gantt
    title TradeMasteræ·±åº¦é›†æˆé¡¹ç›®è®¡åˆ’
    dateFormat  YYYY-MM-DD
    section é˜¶æ®µ1: åŸºç¡€é›†æˆ
    APIé‡æ„           :active, stage1-api, 2024-02-01, 7d
    é…ç½®æœåŠ¡          :stage1-config, after stage1-api, 5d
    ä»»åŠ¡é˜Ÿåˆ—          :stage1-queue, after stage1-api, 5d
    å‰ç«¯é›†æˆ          :stage1-frontend, after stage1-config, 3d
    
    section é˜¶æ®µ2: æ ¸å¿ƒåŠŸèƒ½
    è®­ç»ƒæ‰§è¡Œå™¨        :stage2-trainer, after stage1-frontend, 7d
    å®æ—¶æ¨é€          :stage2-realtime, after stage2-trainer, 5d
    å›æµ‹åŠŸèƒ½          :stage2-backtest, after stage2-trainer, 5d
    ç›‘æ§é¢æ¿          :stage2-monitor, after stage2-realtime, 3d
    
    section é˜¶æ®µ3: é«˜çº§åŠŸèƒ½
    èµ„æºç®¡ç†          :stage3-resource, after stage2-monitor, 7d
    å®¹å™¨åŒ–éƒ¨ç½²        :stage3-container, after stage3-resource, 5d
    å®ç›˜äº¤æ˜“          :stage3-live, after stage3-container, 10d
    
    section é˜¶æ®µ4: å®Œå–„ä¼˜åŒ–
    ç›‘æ§è¿ç»´          :stage4-ops, after stage3-live, 5d
    æ–‡æ¡£ç¼–å†™          :stage4-docs, after stage4-ops, 5d
    æµ‹è¯•éªŒæ”¶          :stage4-test, after stage4-docs, 3d
```

### å…³é”®é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | æ—¥æœŸ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|------|--------|----------|
| M1: åŸºç¡€é›†æˆå®Œæˆ | Week 2 | å¯ç”¨çš„ç­–ç•¥APIé›†æˆ | å‰ç«¯å¯æ˜¾ç¤ºçœŸå®ç­–ç•¥çŠ¶æ€ |
| M2: è®­ç»ƒåŠŸèƒ½å®Œæˆ | Week 4 | å®Œæ•´è®­ç»ƒç”Ÿå‘½å‘¨æœŸ | æˆåŠŸè¿è¡Œç«¯åˆ°ç«¯è®­ç»ƒ |
| M3: é«˜çº§åŠŸèƒ½å®Œæˆ | Week 7 | å®ç›˜äº¤æ˜“åŠŸèƒ½ | é€šè¿‡å®‰å…¨æ€§å’Œé£é™©è¯„ä¼° |
| M4: é¡¹ç›®äº¤ä»˜ | Week 8 | å®Œæ•´ç³»ç»Ÿå’Œæ–‡æ¡£ | é€šè¿‡ç”¨æˆ·éªŒæ”¶æµ‹è¯• |

---

## ğŸ’¡ æŠ€æœ¯åˆ›æ–°ç‚¹

### 1. æ™ºèƒ½é…ç½®ç”Ÿæˆ
ä½¿ç”¨æœºå™¨å­¦ä¹ ç®—æ³•åˆ†æå†å²æœ€ä¼˜é…ç½®ï¼Œä¸ºæ–°ç­–ç•¥æä¾›æ™ºèƒ½åŒ–å‚æ•°å»ºè®®ã€‚

### 2. è‡ªé€‚åº”èµ„æºè°ƒåº¦
åŸºäºè®­ç»ƒä»»åŠ¡çš„å¤æ‚åº¦å’Œå†å²èµ„æºä½¿ç”¨æ¨¡å¼ï¼ŒåŠ¨æ€åˆ†é…è®¡ç®—èµ„æºã€‚

### 3. é¢„æµ‹æ€§ç›‘æ§
é€šè¿‡å¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼Œæå‰è¯†åˆ«æ½œåœ¨çš„ç³»ç»Ÿæ•…éšœå’Œæ€§èƒ½é—®é¢˜ã€‚

### 4. å¤šæ¨¡æ€äº¤äº’
æ”¯æŒè‡ªç„¶è¯­è¨€ç­–ç•¥æè¿°ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºTradeMasteré…ç½®å‚æ•°ã€‚

---

## ğŸ” è´¨é‡ä¿è¯ç­–ç•¥

### æµ‹è¯•ç­–ç•¥

```python
# é›†æˆæµ‹è¯•ç¤ºä¾‹
class TestTradeMasterIntegration:
    def test_strategy_creation_flow(self):
        """æµ‹è¯•ç­–ç•¥åˆ›å»ºå®Œæ•´æµç¨‹"""
        # 1. åˆ›å»ºç­–ç•¥
        strategy = create_test_strategy()
        # 2. ç”Ÿæˆé…ç½®
        config = generate_trademaster_config(strategy)
        # 3. éªŒè¯é…ç½®
        assert validate_config(config) == True
        # 4. æäº¤è®­ç»ƒä»»åŠ¡
        task_id = submit_training_task(strategy.id, config)
        # 5. éªŒè¯ä»»åŠ¡çŠ¶æ€
        assert get_task_status(task_id) == "pending"
```

### æ€§èƒ½æµ‹è¯•åŸºå‡†

- ğŸ¯ **å“åº”æ—¶é—´**: APIå“åº” < 500msï¼Œé¡µé¢åŠ è½½ < 3s
- ğŸ¯ **å¹¶å‘æ€§èƒ½**: æ”¯æŒ100ä¸ªå¹¶å‘ç”¨æˆ·åŒæ—¶è®¿é—®
- ğŸ¯ **è®­ç»ƒæ€§èƒ½**: å•ä¸ªè®­ç»ƒä»»åŠ¡å¯åŠ¨æ—¶é—´ < 30s
- ğŸ¯ **æ•°æ®æ¨é€**: å®æ—¶æ•°æ®å»¶è¿Ÿ < 1s

### ä»£ç è´¨é‡æ ‡å‡†

- âœ… **ä»£ç è¦†ç›–ç‡**: å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… **é™æ€åˆ†æ**: é€šè¿‡PyLintå’ŒMyPyæ£€æŸ¥
- âœ… **å®‰å…¨æ‰«æ**: é€šè¿‡Banditå®‰å…¨æ‰«æ
- âœ… **ä¾èµ–æ£€æŸ¥**: å®šæœŸæ›´æ–°å’Œæ¼æ´æ‰«æ

---

## ğŸš€ éƒ¨ç½²å’Œè¿ç»´

### Docker Composeé…ç½®

```yaml
# docker-compose.production.yml
version: '3.8'
services:
  web:
    build: ./frontend
    ports:
      - "3000:3000"
    environment:
      - VITE_API_BASE_URL=http://api:8000
      
  api:
    build: ./backend
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/trademaster
      - REDIS_URL=redis://redis:6379/0
      - CELERY_BROKER_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis
      
  worker:
    build: ./backend
    command: celery -A app.core.celery worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/trademaster
      - REDIS_URL=redis://redis:6379/0
      - CELERY_BROKER_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis
    volumes:
      - trademaster_data:/app/data
      
  postgres:
    image: postgres:14
    environment:
      - POSTGRES_DB=trademaster
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
      
  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data
      
  monitor:
    image: prom/prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./config/prometheus.yml:/etc/prometheus/prometheus.yml
      
volumes:
  postgres_data:
  redis_data:
  trademaster_data:
```

### ç›‘æ§é…ç½®

```yaml
# config/prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'trademaster-api'
    static_configs:
      - targets: ['api:8000']
    metrics_path: '/metrics'
    
  - job_name: 'celery-worker'
    static_configs:
      - targets: ['worker:9540']
```

---

## ğŸ“š ç›¸å…³èµ„æº

### æŠ€æœ¯æ–‡æ¡£
- [FastAPIå®˜æ–¹æ–‡æ¡£](https://fastapi.tiangolo.com/)
- [Celeryç”¨æˆ·æŒ‡å—](https://docs.celeryproject.org/)
- [Reactå®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [TradeMasteré¡¹ç›®æ–‡æ¡£](../CLAUDE.md)

### å¼€å‘å·¥å…·
- **IDEæ¨è**: VS Code + Pythonæ‰©å±•
- **APIæµ‹è¯•**: Postman + Thunder Client
- **æ•°æ®åº“å·¥å…·**: pgAdmin + Redis Commander
- **ç›‘æ§å·¥å…·**: Grafana + Prometheus

### å­¦ä¹ èµ„æº
- **é‡åŒ–äº¤æ˜“**: [TradeMasteræ•™ç¨‹](../tutorial/)
- **å¾®æœåŠ¡æ¶æ„**: ç›¸å…³æœ€ä½³å®è·µæ–‡æ¡£
- **Dockeréƒ¨ç½²**: [éƒ¨ç½²æŒ‡å—](../deploy/)

---

## ğŸ¯ ç»“è®ºå’Œåç»­è§„åˆ’

### é¡¹ç›®ä»·å€¼
è¿™ä¸ªæ·±åº¦é›†æˆæ–¹æ¡ˆå°†æŠŠTradeMaster Webç•Œé¢ä»åŸå‹é˜¶æ®µæå‡åˆ°ç”Ÿäº§çº§é‡åŒ–äº¤æ˜“å¹³å°ï¼Œä¸ºç”¨æˆ·æä¾›å®Œæ•´çš„ç­–ç•¥å¼€å‘ã€è®­ç»ƒã€éƒ¨ç½²å’Œç›‘æ§èƒ½åŠ›ã€‚

### æŠ€æœ¯æ”¶ç›Š
- ğŸš€ **æ€§èƒ½æå‡**: ä»æ¨¡æ‹Ÿæ•°æ®åˆ°çœŸå®è®¡ç®—çš„è´¨çš„é£è·ƒ
- ğŸ”„ **åŠŸèƒ½å®Œæ•´**: è¦†ç›–é‡åŒ–äº¤æ˜“çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
- ğŸ›¡ï¸ **å¯é æ€§**: ç”Ÿäº§çº§çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§
- ğŸ“ˆ **å¯æ‰©å±•**: æ”¯æŒæœªæ¥åŠŸèƒ½æ‰©å±•å’Œæ€§èƒ½æ‰©å±•

### åç»­æ¼”è¿›æ–¹å‘
1. **AIå¢å¼º**: é›†æˆæ›´å…ˆè¿›çš„æœºå™¨å­¦ä¹ ç®—æ³•
2. **å¤šäº‘éƒ¨ç½²**: æ”¯æŒAWSã€Azureã€GCPéƒ¨ç½²
3. **ç§»åŠ¨ç«¯**: å¼€å‘iOSå’ŒAndroidåº”ç”¨
4. **ç”Ÿæ€æ‰©å±•**: å»ºç«‹ç¬¬ä¸‰æ–¹æ’ä»¶å¸‚åœº

---

**åˆ¶å®šå®Œæˆæ—¶é—´**: 2025-01-28  
**æ–‡æ¡£ç»´æŠ¤**: éšé¡¹ç›®è¿›å±•æŒç»­æ›´æ–°  
**æŠ€æœ¯æ”¯æŒ**: æµ®æµ®é…± (@çŒ«å¨˜å·¥ç¨‹å¸ˆ)

> è¿™æ˜¯ä¸€ä¸ªé›„å¿ƒå‹ƒå‹ƒä½†å®Œå…¨å¯è¡Œçš„æŠ€æœ¯æ–¹æ¡ˆã€‚é€šè¿‡åˆ†é˜¶æ®µå®æ–½å’Œä¸¥æ ¼çš„è´¨é‡æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨8å‘¨å†…äº¤ä»˜ä¸€ä¸ªç”Ÿäº§çº§çš„é‡åŒ–äº¤æ˜“å¹³å°å–µ~ o(*ï¿£ï¸¶ï¿£*)o